# Usage

## Opening POD5 Files

1. Launch Squiggy
2. Click the **"Open POD5 File"** button or use **File → Open POD5 File** (Ctrl/Cmd+O)
3. Navigate to and select your POD5 file
4. The application will load all available reads

Alternatively, you can:
- Use **File → Open Sample Data** (Ctrl/Cmd+Shift+O) to load the bundled sample POD5 file
- Launch with a file from command line: `squiggy --file /path/to/file.pod5`

## Optional: Adding Base Annotations

Squiggy can display base annotations overlaid on the signal if you have a BAM file with basecalls:

1. After loading a POD5 file, click **"Open BAM File"**
2. Select the corresponding BAM file (must contain the same read IDs)
3. The **"Event-aligned"** plot mode will become available

**Requirements:**
- The BAM file must contain move tables (generated by modern Oxford Nanopore basecallers like Dorado or Guppy)
- Install pysam: `pip install pysam`

## Viewing Reads

Once a POD5 file is loaded:

- **Read List**: All read IDs from the file appear in the left panel
- **Search**: Use the search box to filter reads by ID
- **Single Selection**: Click any read ID to visualize it
- **Multiple Selection**: Hold Ctrl/Cmd and click to select multiple reads, or Shift+click for ranges

## Plot Modes

Squiggy offers multiple visualization modes (expand **Plot Options** panel to access):

### Single Read Mode (Default)
- Displays one read at a time
- Best for examining individual read quality and characteristics
- Shows time (seconds) on X-axis, raw signal (pA) on Y-axis

### Overlay Mode
- Displays multiple reads on the same axes
- Best for comparing signal variation across reads
- Supports up to 10 reads simultaneously
- Each read shown in a different color (colorblind-friendly palette)
- Requires normalization for meaningful comparison

### Stacked Mode (Squigualiser-style)
- Displays multiple reads vertically offset
- Best for visualizing patterns across multiple reads
- Each read is vertically spaced for clarity
- Great for seeing consensus signal behavior

### Event-Aligned Mode
- Displays reads with base annotations (requires BAM file)
- Shows bases with fixed width (one unit per base)
- Colored bands indicate bases (A=green, C=blue, G=orange, T=red)
- Signal is averaged per base for cleaner visualization
- Best for examining base-level signal characteristics

## Signal Normalization

Normalization is crucial when comparing signals across reads. Available methods:

- **None (raw signal)**: Original pA values - best for single read examination
- **Z-score**: Mean=0, Std=1 - best for comparing reads (default for multi-read modes)
- **Median**: Median-centered - robust to outliers
- **MAD (Median Absolute Deviation)**: Most robust - handles extreme outliers well

## Understanding Squiggle Plots

The squiggle plot shows:

- **X-axis**: Time (seconds) or base position (depending on mode)
- **Y-axis**: Signal (pA or normalized units)
- **Line color**: Indicates different reads in multi-read modes

Each peak and valley represents ionic current changes as DNA/RNA molecules pass through the nanopore.

## Exporting Plots

You can export the currently displayed plot to a high-quality image file:

1. Display the plot you want to export
2. Go to **File → Export Plot** (Ctrl/Cmd+E)
3. Choose a file format:
   - **PNG**: Raster image, good for presentations and documents
   - **PDF**: Vector format, scalable without quality loss
   - **SVG**: Vector format, editable in graphics software
4. Choose location and filename
5. Click **Save**

Export settings:
- Plots are exported at 300 DPI (high quality)
- Default size: 12" × 8" (suitable for publications)

## Tips

- **Large files**: POD5 files can contain thousands of reads. Use the search box to quickly find specific reads
- **Multi-read comparison**: Use Overlay mode with Z-score normalization to compare signal patterns
- **Plot quality**: Plots are generated at high resolution suitable for screenshots and presentations
- **Performance**: The first read visualization may take a moment as libraries initialize; subsequent plots render quickly
- **Collapsible panels**: Click "POD5 File Information" or "Plot Options" headers to expand/collapse panels

## Keyboard Shortcuts

- **Ctrl/Cmd + O**: Open POD5 file dialog
- **Ctrl/Cmd + Shift + O**: Open sample data
- **Ctrl/Cmd + E**: Export current plot
- **Ctrl/Cmd + Q**: Quit application

## File Format Support

Squiggy supports POD5 files, which are the standard format for Oxford Nanopore raw signal data:

- POD5 is an HDF5-based format with VBZ compression
- Files typically have `.pod5` extension
- Contains raw signal data plus metadata (sample rate, read IDs, etc.)

## Troubleshooting

**Application won't start**
- On macOS: Check System Preferences → Security to allow the app
- On Linux: Ensure the executable has run permissions (`chmod +x Squiggy`)

**Can't open POD5 file**
- Verify the file is a valid POD5 format
- Check that the file isn't corrupted or incomplete

**Plots not displaying**
- Ensure the read has valid signal data
- Try selecting a different read to verify functionality
