[workspace]
name = "squiggy-positron"
version = "0.1.0"
description = "Positron extension for visualizing Oxford Nanopore sequencing data"
authors = ["Jay Hesselberth <jay.hesselberth@gmail.com>"]
channels = ["conda-forge"]
platforms = ["osx-arm64", "osx-64", "linux-64", "win-64"]

[tasks]
# === Setup ===
# Note: Run 'npm install' manually after 'pixi install' or use task below
setup = { depends-on = ["setup-npm", "setup-python"] }
setup-npm = "npm install"
setup-python = "uv pip install --system -e ."

# === Version Management ===
sync = "node scripts/sync-version.js"

# === Main Development Workflow ===
dev = "npm run watch"
test = { depends-on = ["test-py", "test-ts"] }
check = { depends-on = ["lint", "test"] }
build = "npm run package"
clean = "rm -rf build/ .pytest_cache/ .ruff_cache/ site/ squiggy.egg-info/ squiggy/__pycache__/ src/squiggy.egg-info/ src/squiggy/ test-*/ tests/__pycache__/ .DS_Store"
render-notebooks = "jupyter nbconvert --to notebook --execute --inplace examples/*.ipynb"
docs = { depends-on = ["render-notebooks"], cmd = "mkdocs serve" }

# === Granular Tasks ===
# TypeScript
compile = "npm run compile"
test-ts = "npm test"
lint-ts = "npm run lint"
format-ts = "npm run format"

# Python
test-py = "python -m pytest tests/ -v"
lint-py = "ruff check squiggy/ tests/"
format-py = "ruff format squiggy/ tests/"

# Combined
lint = { depends-on = ["format-py", "format-ts", "lint-py", "lint-ts"] }
format = { depends-on = ["format-py", "format-ts"] }

[dependencies]
python = "3.12.*"
nodejs = ">=20"

# Conda packages
numpy = ">=1.24.0"
pillow = ">=10.0.0"
pytest = ">=7.0.0"
pytest-cov = ">=4.0.0"
ruff = ">=0.1.0"
mkdocs = ">=1.5.0"
mkdocs-material = ">=9.0.0"

[pypi-dependencies]
# PyPI-only packages
pod5 = ">=0.3.0"
pysam = ">=0.22.0"
bokeh = ">=3.0.0"
selenium = ">=4.6.0"
mkdocstrings = { version = ">=0.24.0", extras = ["python"] }
mike = ">=2.0.0"
nbconvert = ">=7.0.0"
ipykernel = ">=6.0.0"
