[workspace]
name = "squiggy-positron"
version = "0.1.0"
description = "Positron extension for visualizing Oxford Nanopore sequencing data"
authors = ["Jay Hesselberth <jay.hesselberth@gmail.com>"]
channels = ["conda-forge"]
platforms = ["osx-arm64", "osx-64", "linux-64", "win-64"]

[environments]
# Default environment includes dev tools (for most contributors)
default = { features = ["dev"], solve-group = "default" }
# Docs environment includes everything (for maintainers building documentation)
docs = { features = ["dev", "docs"], solve-group = "default" }

[tasks]
# === Setup ===
# Note: Run 'npm install' manually after 'pixi install' or use task below
setup = "npm install"

# === Version Management ===
sync = "node scripts/sync-version.js"

# === Main Development Workflow ===
dev = "npm run watch"
test = { depends-on = ["test-py", "test-ts"] }
check = { depends-on = ["lint", "test"] }
build = "npm run package"
clean = "rm -rf build/ .pytest_cache/ .ruff_cache/ site/ squiggy.egg-info/ squiggy/__pycache__/ src/squiggy.egg-info/ src/squiggy/ test-workspace/ tests/__pycache__/ .DS_Store"
docs = "mkdocs serve"

# === Granular Tasks ===
# TypeScript
compile = "npm run compile"
test-ts = "npm test"
lint-ts = "npm run lint"
format-ts = "npm run format"

# Python
test-py = "python -m pytest tests/ -v"
lint-py = "ruff check squiggy/ tests/"
format-py = "ruff format squiggy/ tests/"

# Combined
lint = { depends-on = ["format-py", "format-ts", "lint-py", "lint-ts"] }
format = { depends-on = ["format-py", "format-ts"] }

[dependencies]
# Core runtime dependencies
python = "3.12.*"
nodejs = ">=20"
numpy = ">=1.24.0"

[pypi-dependencies]
# Runtime Python packages
pod5 = ">=0.3.0"
pysam = ">=0.22.0"
bokeh = ">=3.0.0"

[feature.dev.dependencies]
# Development and testing tools
pytest = ">=7.0.0"
pytest-cov = ">=4.0.0"
ruff = ">=0.1.0"

[feature.docs.dependencies]
# Documentation building tools
mkdocs = ">=1.5.0"
mkdocs-material = ">=9.0.0"

[feature.docs.pypi-dependencies]
mkdocstrings = { version = ">=0.24.0", extras = ["python"] }
mike = ">=2.0.0"
